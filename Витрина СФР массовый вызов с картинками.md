Как это выглядит
![[Pasted image 20250501180110.png]]

### Теперь детали:
![[Pasted image 20250501180227.png]]
Метод `POST`
Путь до сервиса `/api/nsi/v1/dictionary/vtr_sfr_work_activity`
# Тело запроса:
```json
{
    "filter": {
        "union": {
            "unionKind": "AND",
            "subs": [
                {
                    "simple": {
                        "attributeName": "birthdate",
                        "condition": "EQUALS",
                        "value": {
                            "asString": "${BIRTHDATE}"
                        }
                    }
                },
                {
                    "simple": {
                        "attributeName": "snils",
                        "condition": "EQUALS",
                        "value": {
                            "asString": "${SNILS}"
                        }
                    }
                },
                {
                    "simple": {
                        "attributeName": "startdate",
                        "condition": "EQUALS",
                        "value": {
                            "asString": "${STARTDATE}"
                        }
                    }
                },
                {
                    "simple": {
                        "attributeName": "enddate",
                        "condition": "EQUALS",
                        "value": {
                            "asString": "${ENDDATE}"
                        }
                    }
                }
            ]
        }
    },
    "treeFiltering": "ONELEVEL",
    "pageNum": 1,
    "pageSize": "100",
    "parentRefItemValue": "",
    "selectAttributes": [
        "*"
    ],
    "tx": ""
}
```
Как мы видим с тела запроса, нам необходимо передавать Дату рождения, СНИЛС и период, за который запрашиваются сведения
![[Pasted image 20250501180351.png]]
Дополнительные детали
Ключ `Accept`
Значение `application/json, text/plain, */*`
Ключ `Content-Type`
Значение `application/json`
Код справочника `vtr_sfr_work_activity`
![[Pasted image 20250501180504.png]]
Как мы видим, что-то интересное извлекается с компонента s32c7 - в моём случае, это компонент ValueCalculator, в котором я подготавливаю данные для запроса в нужный для запроса формат
![[Pasted image 20250501180604.png]]
Содержимое каждого из linkedValues
`BIRTHDATE`
```json
{
    "expression1": "arg1",
    "arg1": "'${s32c7.arguments.birthDate}'"
}
```
`SNILS`
```json
{
    "expression1": "arg1.replaceAll('[-\\s]', '')",
    "arg1": "'${s32c7.arguments.snils}'"
}
```
`STARTDATE`
```json
{
    "expression1": "getIf(arg1.length() == 2, arg2 + '-' + asString(asInt(arg1) + 1) + '-' + '01')",
    "expression2": "getIf(arg1.length() != 2 && arg1 == '9', arg2 + '-' + asString(asInt(arg1) + 1) + '-' + '01')",
    "expression3": "getIf(arg1.length() != 2 && arg1 != 'empty' && arg1 != '9', arg2 + '-0' + asString(asInt(arg1) + 1) + '-' + '01')",
    "expression4": "getIf(arg1 == 'empty', arg3)",
    "arg1": "'${startDate.month}'",
    "arg2": "'${startDate.year}'",
    "arg3": "'${s32c7.arguments.birthDate}'"
}
```
`ENDDATE`
```json
{
    "expression1": "getIf(arg1.length() == 2, asString(asDate(arg2 + '-' + asString(asInt(arg1) + 1) + '-' + '31', 'yyyy-MM-dd')))",
    "expression2": "getIf(arg1.length() != 2 && arg1 == '9', arg2 + '-' + asString(asInt(arg1) + 1) + '-' + '01')",
    "expression3": "getIf(arg1.length() != 2 && arg1 != 'empty' && arg1 != '9', asString(asDate(arg2 + '-0' + asString(asInt(arg1) + 1) + '-' + '31', 'yyyy-MM-dd')))",
    "expression4": "getIf(arg1 == 'empty', asString(asDate(arg3, 'yyyy-MM-dd')))",
    "arg1": "'${endDate.month}'",
    "arg2": "'${endDate.year}'",
    "arg3": "asString('${variable.today}').substring(0,10)"
}
```
Содержимое компонента s32c7
```json
{
    "linkedValues": [
        {
            "argument": "snils",
            "jsonLogic": {
                "value": "answer.s41c5.value"
            }
        },
        {
            "argument": "birthDate",
            "jsonLogic": {
                "substr": [
                    "answer.s41c6.value", 
                    0,
                    10
                ]
            }
        }
    ]
}
```
Значения мы берём с каждого экрана повторяшки в цикле, соответственно, нам необходимо получать тот или иной СНИЛС с датой рождения для их подготовки к передаче в составе запроса к витрине СФР
Поскольку после запроса будет получен ответ, необходимо прописать следующие правила